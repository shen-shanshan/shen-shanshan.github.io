<!DOCTYPE html>
<html lang="en" dir="ltr" class="scroll-smooth" data-default-appearance="dark"
  data-auto-appearance="true"><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta charset="utf-8" />
  
  <meta http-equiv="content-language" content="en" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="X-UA-Compatible" content="ie=edge" />
  
  <title>Ascend aclnn 算子开发入门 &middot; Home</title>
  <meta name="title" content="Ascend aclnn 算子开发入门 &middot; Home" />
  
  
  <meta name="keywords" content="AI Infra, 算子开发, Ascend, NPU, CANN, " />
  
  
  <link rel="canonical" href="http://localhost:1313/articles/ascend-aclnn-%E7%AE%97%E5%AD%90%E5%BC%80%E5%8F%91%E5%85%A5%E9%97%A8/" />
  
  
  
  
  
  
  
  
  
  
  
  
  <link type="text/css" rel="stylesheet" href="/css/main.bundle.min.c7683369d42ab0fa43c2faab379ff224b7030c0e984512cb4535d4888fb382e395322f3ef135ac80c0de62846aad770528c8a3cc249062ca58b1fb90c095bbcd.css"
    integrity="sha512-x2gzadQqsPpDwvqrN5/yJLcDDA6YRRLLRTXUiI&#43;zguOVMi8&#43;8TWsgMDeYoRqrXcFKMijzCSQYspYsfuQwJW7zQ==" />
  
  
  <script type="text/javascript" src="/js/appearance.min.516a16745bea5a9bd011138d254cc0fd3973cd55ce6e15f3dec763e7c7c2c7448f8fe7b54cca811cb821b0c7e12cd161caace1dd794ac3d34d40937cbcc9ee12.js"
    integrity="sha512-UWoWdFvqWpvQERONJUzA/TlzzVXObhXz3sdj58fCx0SPj&#43;e1TMqBHLghsMfhLNFhyqzh3XlKw9NNQJN8vMnuEg=="></script>
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <script defer type="text/javascript" id="script-bundle" src="/js/main.bundle.min.a2d78d78672e549fbfc972ece871725b5478ba0b65708dda20cb97ab80a865eae6d247e1b05a4aec6ebbf78647ec3233bad8b2609ed98eee53cd58aa17128bc7.js"
    integrity="sha512-oteNeGcuVJ&#43;/yXLs6HFyW1R4ugtlcI3aIMuXq4CoZerm0kfhsFpK7G6794ZH7DIzutiyYJ7Zju5TzViqFxKLxw==" data-copy="" data-copied=""></script>
  
  
  
  <script src="/lib/zoom/zoom.min.37d2094687372da3f7343a221a470f6b8806f7891aa46a5a03966af7f0ebd38b9fe536cb154e6ad28f006d184b294525a7c4054b6bbb4be62d8b453b42db99bd.js" integrity="sha512-N9IJRoc3LaP3NDoiGkcPa4gG94kapGpaA5Zq9/Dr04uf5TbLFU5q0o8AbRhLKUUlp8QFS2u7S&#43;Yti0U7QtuZvQ=="></script>
  
  
  
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
  <link rel="manifest" href="/site.webmanifest" />
  
  
  
  
  
  
  
  
  <meta property="og:url" content="http://localhost:1313/articles/ascend-aclnn-%E7%AE%97%E5%AD%90%E5%BC%80%E5%8F%91%E5%85%A5%E9%97%A8/">
  <meta property="og:site_name" content="Home">
  <meta property="og:title" content="Ascend aclnn 算子开发入门">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-10-23T15:52:36+00:00">
    <meta property="article:modified_time" content="2024-10-23T15:52:36+00:00">
    <meta property="article:tag" content="AI Infra">
    <meta property="article:tag" content="算子开发">
    <meta property="article:tag" content="Ascend">
    <meta property="article:tag" content="NPU">
    <meta property="article:tag" content="CANN">
    <meta property="og:image" content="http://localhost:1313/articles/ascend-aclnn-%E7%AE%97%E5%AD%90%E5%BC%80%E5%8F%91%E5%85%A5%E9%97%A8/featured.jpg">

  
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="http://localhost:1313/articles/ascend-aclnn-%E7%AE%97%E5%AD%90%E5%BC%80%E5%8F%91%E5%85%A5%E9%97%A8/featured.jpg">
  <meta name="twitter:title" content="Ascend aclnn 算子开发入门">

  
  <script type="application/ld+json">
  [{
    "@context": "https://schema.org",
    "@type": "Article",
    "articleSection": "Articles",
    "name": "Ascend aclnn 算子开发入门",
    "headline": "Ascend aclnn 算子开发入门",
    
    
    "inLanguage": "en",
    "url" : "http:\/\/localhost:1313\/articles\/ascend-aclnn-%E7%AE%97%E5%AD%90%E5%BC%80%E5%8F%91%E5%85%A5%E9%97%A8\/",
    "author" : {
      "@type": "Person",
      "name": "Shanshan Shen"
    },
    "copyrightYear": "2024",
    "dateCreated": "2024-10-23T15:52:36\u002b00:00",
    "datePublished": "2024-10-23T15:52:36\u002b00:00",
    
    "dateModified": "2024-10-23T15:52:36\u002b00:00",
    
    "keywords": ["AI Infra","算子开发","Ascend","NPU","CANN"],
    
    "mainEntityOfPage": "true",
    "wordCount": "1663"
  }]
  </script>


  
  
  <meta name="author" content="Shanshan Shen" />
  
  
  
  <link href="https://github.com/shen-shanshan" rel="me" />
  
  
  <link href="https://gitee.com/shenshanshan0918" rel="me" />
  
  
  <link href="https://blog.csdn.net/weixin_44162047?type=blog" rel="me" />
  
  
  <link href="https://www.zhihu.com/people/sss-53-26" rel="me" />
  
  
  <link href="https://space.bilibili.com/14112152?spm_id_from=333.1007.0.0" rel="me" />
  
  
  <link href="https://music.163.com/#/artist?id=62054947" rel="me" />
  
  
  
  

<script src="/lib/jquery/jquery.slim.min.b0dca576e87d7eaa5850ae4e61759c065786cdb6489d68fcc82240539eebd5da522bdb4fda085ffd245808c8fe2acb2516408eb774ef26b5f6015fc6737c0ea8.js" integrity="sha512-sNylduh9fqpYUK5OYXWcBleGzbZInWj8yCJAU57r1dpSK9tP2ghf/SRYCMj&#43;KsslFkCOt3TvJrX2AV/Gc3wOqA=="></script>






















  
  



  
  
  <meta name="theme-color"/>
  
  
</head>
<body
  class="flex flex-col h-screen px-6 m-auto text-lg leading-7 max-w-7xl bg-neutral text-neutral-900 dark:bg-neutral-800 dark:text-neutral sm:px-14 md:px-24 lg:px-32 scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600">
  <div id="the-top" class="absolute flex self-center">
    <a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 focus:translate-y-0 dark:bg-neutral-600"
      href="#main-content"><span
        class="font-bold text-primary-600 ltr:pr-2 rtl:pl-2 dark:text-primary-400">&darr;</span>Skip to main content</a>
  </div>
  
  
  <div class="min-h-[148px]"></div>
<div class="fixed inset-x-0 min-h-[130px] opacity-65 pl-[24px] pr-[24px] bg-gradient-to-b from-neutral from-60% dark:from-neutral-800 to-transparent mix-blend-normal" style="z-index:80"></div>
<div class="fixed inset-x-0 pl-[24px] pr-[24px]" style="z-index:100">
  <div id="menu-blur" class="absolute opacity-0 inset-x-0 top-0 h-full single_hero_background nozoom backdrop-blur-2xl shadow-2xl"></div>
  <div class="relative max-w-[64rem] ml-auto mr-auto">
    <div style="padding-left:0;padding-right:0;padding-top:2px;padding-bottom:3px"
    class="main-menu flex items-center justify-between px-4 py-6 sm:px-6 md:justify-start space-x-3">
    
    <div class="flex flex-1 items-center justify-between">
        <nav class="flex space-x-3">

            
            <a href="/" class="text-base font-medium text-gray-500 hover:text-gray-900">Home</a>
            

        </nav>
        <nav class="hidden md:flex items-center space-x-5 md:ml-12 h-12">

            
            
            
  <a href="/guide/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
    
    <p class="text-base font-medium" title="">
        Guide
    </p>
</a>



            
            
  <a href="/articles/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
    
    <p class="text-base font-medium" title="">
        Articles
    </p>
</a>



            
            
  <a href="/categories/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
    
    <p class="text-base font-medium" title="">
        Categories
    </p>
</a>



            
            
  <a href="/tags/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
    
    <p class="text-base font-medium" title="">
        Tags
    </p>
</a>



            
            
  <a href="/about/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
    
    <p class="text-base font-medium" title="">
        About
    </p>
</a>



            
            
  <a href="/roadmap/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
    
    <p class="text-base font-medium" title="">
        Roadmap
    </p>
</a>



            
            

            


            
            <button id="search-button" aria-label="Search" class="text-base hover:text-primary-600 dark:hover:text-primary-400"
                title="">
                

  <span class="relative block icon">
    <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>

  </span>


            </button>
            


            
            
            <div
                class="ltr:mr-14 rtl:ml-14 flex items-center">
                <button id="appearance-switcher" aria-label="Dark mode switcher" type="button" class="text-base hover:text-primary-600 dark:hover:text-primary-400">
                    <div class="flex items-center justify-center dark:hidden">
                        

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M32 256c0-123.8 100.3-224 223.8-224c11.36 0 29.7 1.668 40.9 3.746c9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3c9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480C132.1 480 32 379.6 32 256z"/></svg>

  </span>


                    </div>
                    <div class="items-center justify-center hidden dark:flex">
                        

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02 0-95.1 42.98-95.1 95.1S202.1 351.1 256 351.1s95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347L446.1 255.1l63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7l-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89L164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6L12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256l-63.15 91.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7l19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109l109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69 0-127.1-57.31-127.1-127.1c0-70.69 57.31-127.1 127.1-127.1s127.1 57.3 127.1 127.1C383.1 326.7 326.7 383.1 256 383.1z"/></svg>

  </span>


                    </div>
                </button>
            </div>
            

        </nav>
        <div class="flex md:hidden items-center space-x-5 md:ml-12 h-12">

            <span></span>

            


            
            <button id="search-button-mobile" aria-label="Search" class="text-base hover:text-primary-600 dark:hover:text-primary-400"
                title="">
                

  <span class="relative block icon">
    <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>

  </span>


            </button>
            

            
            
            <button id="appearance-switcher-mobile" aria-label="Dark mode switcher" type="button" class="text-base hover:text-primary-600 dark:hover:text-primary-400" style="margin-right:5px">
                <div class="flex items-center justify-center dark:hidden">
                    

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M32 256c0-123.8 100.3-224 223.8-224c11.36 0 29.7 1.668 40.9 3.746c9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3c9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480C132.1 480 32 379.6 32 256z"/></svg>

  </span>


                </div>
                <div class="items-center justify-center hidden dark:flex">
                    

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02 0-95.1 42.98-95.1 95.1S202.1 351.1 256 351.1s95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347L446.1 255.1l63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7l-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89L164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6L12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256l-63.15 91.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7l19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109l109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69 0-127.1-57.31-127.1-127.1c0-70.69 57.31-127.1 127.1-127.1s127.1 57.3 127.1 127.1C383.1 326.7 326.7 383.1 256 383.1z"/></svg>

  </span>


                </div>
            </button>
            

        </div>
    </div>
    <div class="-my-2 -mr-2 md:hidden">

        <label id="menu-button" class="block">
            
            <div class="cursor-pointer hover:text-primary-600 dark:hover:text-primary-400">
                

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M0 96C0 78.33 14.33 64 32 64H416C433.7 64 448 78.33 448 96C448 113.7 433.7 128 416 128H32C14.33 128 0 113.7 0 96zM0 256C0 238.3 14.33 224 32 224H416C433.7 224 448 238.3 448 256C448 273.7 433.7 288 416 288H32C14.33 288 0 273.7 0 256zM416 448H32C14.33 448 0 433.7 0 416C0 398.3 14.33 384 32 384H416C433.7 384 448 398.3 448 416C448 433.7 433.7 448 416 448z"/></svg>

  </span>


            </div>
            <div id="menu-wrapper" style="padding-top:5px;"
                class="fixed inset-0 z-30 invisible w-screen h-screen m-0 overflow-auto transition-opacity opacity-0 cursor-default bg-neutral-100/50 backdrop-blur-sm dark:bg-neutral-900/50">
                <ul
                    class="flex space-y-2 mt-3 flex-col items-end w-full px-6 py-6 mx-auto overflow-visible list-none ltr:text-right rtl:text-left max-w-7xl">

                    <li id="menu-close-button">
                        <span
                            class="cursor-pointer inline-block align-text-bottom hover:text-primary-600 dark:hover:text-primary-400">

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"/></svg>

  </span>

</span>
                    </li>

                    

                    
  <li class="mt-1">
    <a href="/guide/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-bg font-bg" title="">
            Guide
        </p>
    </a>
</li>




                    

                    
  <li class="mt-1">
    <a href="/articles/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-bg font-bg" title="">
            Articles
        </p>
    </a>
</li>




                    

                    
  <li class="mt-1">
    <a href="/categories/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-bg font-bg" title="">
            Categories
        </p>
    </a>
</li>




                    

                    
  <li class="mt-1">
    <a href="/tags/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-bg font-bg" title="">
            Tags
        </p>
    </a>
</li>




                    

                    
  <li class="mt-1">
    <a href="/about/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-bg font-bg" title="">
            About
        </p>
    </a>
</li>




                    

                    
  <li class="mt-1">
    <a href="/roadmap/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-bg font-bg" title="">
            Roadmap
        </p>
    </a>
</li>




                    

                </ul>
                
                

            </div>
        </label>
    </div>
</div>




<script>
    (function () {
        var $mainmenu = $('.main-menu');
        var path = window.location.pathname;
        $mainmenu.find('a[href="' + path + '"]').each(function (i, e) {
            $(e).children('p').addClass('active');
        });
    })();
</script>


  </div>
</div>
<script>
  window.addEventListener('scroll', function (e) {
    var scroll = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop || 0;
    var background_blur = document.getElementById('menu-blur');
    background_blur.style.opacity = (scroll / 300);
  });
</script>

  
  <div class="relative flex flex-col grow">
    <main id="main-content" class="grow">
      


<article>
  
  
  
  
  
  




    
    <div class="fixed inset-x-0 top-0 h-[800px] single_hero_background nozoom"
    style="background-image:url(/articles/ascend-aclnn-%E7%AE%97%E5%AD%90%E5%BC%80%E5%8F%91%E5%85%A5%E9%97%A8/featured_hu7460752804838276577.jpg);">
    


    <div class="absolute inset-0 bg-gradient-to-t from-neutral dark:from-neutral-800 to-transparent mix-blend-normal">
    </div>
    <div
        class="absolute inset-0 opacity-60 bg-gradient-to-t from-neutral dark:from-neutral-800 to-neutral-100 dark:to-neutral-800 mix-blend-normal">
    </div>
</div>

<div id="background-blur" class="fixed opacity-0 inset-x-0 top-0 h-full single_hero_background nozoom backdrop-blur-2xl"></div>
<script>
    window.addEventListener('scroll', function (e) {
        var scroll = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop || 0;
        var background_blur = document.getElementById('background-blur');
        background_blur.style.opacity = (scroll / 300)
    });
</script>

  
  

  <header id="single_header" class="mt-5 max-w-prose">
    
    <h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">
      Ascend aclnn 算子开发入门
    </h1>
    <div class="mt-1 mb-6 text-base text-neutral-500 dark:text-neutral-400 print:hidden">
      





  
  







  

















  



<div class="flex flex-row flex-wrap items-center">
  
  
  <time datetime="2024-10-23T15:52:36&#43;00:00">2024-10-23</time><span class="px-2 text-primary-500">&middot;</span>


<script type="text/javascript" src="/js/zen-mode.min.63c8a202661f4a2063fdc2706685d668e8ea3da613da2224e9da527e5876e4f53dcac39ab60732626fb4151feae5d430d0cf44731e5d3c726522fcc1519c1547.js" integrity="sha512-Y8iiAmYfSiBj/cJwZoXWaOjqPaYT2iIk6dpSflh25PU9ysOatgcyYm&#43;0FR/q5dQw0M9Ecx5dPHJlIvzBUZwVRw=="></script>

<span class="mb-[2px]">
    <span id="zen-mode-button"
          class="text-lg hover:text-primary-500"
          title="Enable zen mode"
          data-title-i18n-disable="Enable zen mode"
          data-title-i18n-enable="Disable zen mode">
        <span class="inline-block align-text-bottom">

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="50px" height="50px">
    <path fill="currentColor" d="M 12.980469 4 C 9.1204688 4 5.9804688 7.14 5.9804688 11 L 6 26 L 9.9804688 26 L 9.9804688 11 C 9.9804688 9.35 11.320469 8 12.980469 8 L 40.019531 8 C 41.679531 8 43.019531 9.35 43.019531 11 L 43.019531 39 C 43.019531 40.65 41.679531 42 40.019531 42 L 29 42 C 29 43.54 28.420938 44.94 27.460938 46 L 40.019531 46 C 43.879531 46 47.019531 42.86 47.019531 39 L 47.019531 11 C 47.019531 7.14 43.879531 4 40.019531 4 L 12.980469 4 z M 7 28 C 4.794 28 3 29.794 3 32 L 3 42 C 3 44.206 4.794 46 7 46 L 23 46 C 25.206 46 27 44.206 27 42 L 27 32 C 27 29.794 25.206 28 23 28 L 7 28 z M 7 32 L 23 32 L 23.001953 42 L 7 42 L 7 32 z"/>
</svg>
  </span>

</span>
    </span>
</span>
  

  
  
</div>





<div class="flex flex-row flex-wrap items-center">
  
  
  
  
  
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA/&#34;,'_self');">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    计算机
  </span>
</span>
  </span>
  
  
  
  
  
  
  
  
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/tags/ai-infra/&#34;,'_self');">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    AI Infra
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/tags/%E7%AE%97%E5%AD%90%E5%BC%80%E5%8F%91/&#34;,'_self');">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    算子开发
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/tags/ascend/&#34;,'_self');">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Ascend
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/tags/npu/&#34;,'_self');">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    NPU
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/tags/cann/&#34;,'_self');">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    CANN
  </span>
</span>
  </span>
  
  
  
  
</div>




    </div>

    
    
    
    
    

    

    

  </header>
  
  <section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row">
    
     <div
      class="order-first lg:ml-auto px-0 lg:order-last ltr:lg:pl-8 rtl:lg:pr-8">
      <div class="toc ltr:pl-5 rtl:pr-5 print:hidden lg:sticky lg:top-[140px]">

         <details open id="TOCView"
  class="toc-right mt-0 overflow-y-scroll overscroll-contain scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600 rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 hidden lg:block">
  <summary
    class="block py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">
    Table of Contents
  </summary>
  <div
    class="min-w-[220px] py-2 border-dotted ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#一概述">一、概述</a></li>
    <li><a href="#二基本概念">二、基本概念</a>
      <ul>
        <li><a href="#21-device">2.1 Device</a></li>
        <li><a href="#22-context">2.2 Context</a></li>
        <li><a href="#23-stream">2.3 Stream</a></li>
        <li><a href="#24-task">2.4 Task</a></li>
      </ul>
    </li>
    <li><a href="#三单算子开发">三、单算子开发</a>
      <ul>
        <li><a href="#31-单算子调用方式">3.1 单算子调用方式</a></li>
        <li><a href="#32-单算子-api-执行">3.2 单算子 API 执行</a></li>
      </ul>
    </li>
    <li><a href="#四代码实现">四、代码实现</a>
      <ul>
        <li><a href="#41-环境搭建">4.1 环境搭建</a></li>
        <li><a href="#42-单算子开发流程">4.2 单算子开发流程</a></li>
        <li><a href="#43-常见参数说明">4.3 常见参数说明</a></li>
        <li><a href="#44-矩阵加法算子">4.4 矩阵加法算子</a></li>
        <li><a href="#45-矩阵乘法算子">4.5 矩阵乘法算子</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</details>
<details class="toc-inside mt-0 overflow-hidden rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 lg:hidden">
  <summary
    class="py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">
    Table of Contents
  </summary>
  <div
    class="py-2 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#一概述">一、概述</a></li>
    <li><a href="#二基本概念">二、基本概念</a>
      <ul>
        <li><a href="#21-device">2.1 Device</a></li>
        <li><a href="#22-context">2.2 Context</a></li>
        <li><a href="#23-stream">2.3 Stream</a></li>
        <li><a href="#24-task">2.4 Task</a></li>
      </ul>
    </li>
    <li><a href="#三单算子开发">三、单算子开发</a>
      <ul>
        <li><a href="#31-单算子调用方式">3.1 单算子调用方式</a></li>
        <li><a href="#32-单算子-api-执行">3.2 单算子 API 执行</a></li>
      </ul>
    </li>
    <li><a href="#四代码实现">四、代码实现</a>
      <ul>
        <li><a href="#41-环境搭建">4.1 环境搭建</a></li>
        <li><a href="#42-单算子开发流程">4.2 单算子开发流程</a></li>
        <li><a href="#43-常见参数说明">4.3 常见参数说明</a></li>
        <li><a href="#44-矩阵加法算子">4.4 矩阵加法算子</a></li>
        <li><a href="#45-矩阵乘法算子">4.5 矩阵乘法算子</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</details>

<script>

  var margin = 200;
  var marginError = 50;

  (function () {
    var $window = $(window);
    var $toc = $('#TOCView');
    var tocHeight = $toc.height();

    function onResize() {
      var windowAndMarginHeight = $window.height() - margin;
      if(tocHeight >= windowAndMarginHeight) {
        $toc.css("overflow-y", "scroll")
        $toc.css("max-height", (windowAndMarginHeight + marginError) + "px")
      } else {
        $toc.css("overflow-y", "hidden")
        $toc.css("max-height", "9999999px")
      }
    }

    $window.on('resize', onResize);
    $(document).ready(onResize);
  })();



  (function () {
    var $toc = $('#TableOfContents');
    if ($toc.length > 0) {
      var $window = $(window);

      function onScroll() {
        var currentScroll = $window.scrollTop();
        var h = $('.anchor');
        var id = "";
        h.each(function (i, e) {
          e = $(e);
          if (e.offset().top - $(window).height()/3 <= currentScroll) {
            id = decodeURIComponent(e.attr('id'));
          }
        });
        var active = $toc.find('a.active');      
        if (active.length == 1 && active.eq(0).attr('href') == '#' + id) return true;

        active.each(function (i, e) {
          
            $(e).removeClass('active');
          
        });
        $toc.find('a[href="#' + id + '"]').addClass('active')
        $toc.find('a[href="#' + id + '"]').parentsUntil('#TableOfContents').each(function (i, e) {
          $(e).children('a').parents('ul').show();          
        });
      }

      $window.on('scroll', onScroll);
      $(document).ready(function () {
        
        onScroll();
      });
    }
  })();


</script>
   </div>
      </div>
      

      <div class="min-w-0 min-h-0 max-w-fit">
        
        


        <div class="article-content max-w-prose mb-20">
          

<h2 class="relative group">一、概述 
    <div id="%E4%B8%80%E6%A6%82%E8%BF%B0" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%E4%B8%80%E6%A6%82%E8%BF%B0" aria-label="Anchor">#</a>
    </span>        
    
</h2>
<p><strong>什么是算子？</strong></p>
<p>在 AI 框架中，算子一般指一些最基本的代数运算（如：矩阵加法、矩阵乘法等），多个算子之间也可以根据需要组合成更加复杂的融合算子（如：flash-attention 算子等）。算子的输入和输出都是 Tensor（张量）。</p>
<blockquote>
<p>融合算子：将多个独立的“小算子”融合成一个“大算子”，多个小算子的功能和大算子的功能等价，但融合算子在性能或者内存等方面优于独立的小算子。</p>
</blockquote>
<p>另外，算子更多地是 AI 框架中的一个概念，在硬件底层算子具体的执行部分，一般叫做 Kernel（核函数）。</p>
<p>下面将首先对算子开发中涉及的一些基本概念进行介绍（可以用 CUDA 作为参考，大部分概念都是相似的），然后会以具体的矩阵加法和乘法算子的代码实现为例进行讲解。</p>


<h2 class="relative group">二、基本概念 
    <div id="%E4%BA%8C%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%E4%BA%8C%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5" aria-label="Anchor">#</a>
    </span>        
    
</h2>


<h3 class="relative group">2.1 Device 
    <div id="21-device" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#21-device" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<ul>
<li>Host：一般指 CPU（负责调度）；</li>
<li>Device：一般指 GPU、NPU（负责计算）。</li>
</ul>


<h3 class="relative group">2.2 Context 
    <div id="22-context" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#22-context" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<p>Context 主要负责管理线程中各项资源的生命周期。</p>
<p>一般来说，Context 与其它概念之间具有以下关系：</p>
<ul>
<li>一个进程可以创建多个 Context；</li>
<li>一个线程只能同时使用一个 Context，该 Context 对应一个唯一的 Device，线程可以通过切换 Context 来切换要使用的 Device；</li>
<li>一个 Device 可以拥有多个 Context，但同时只能使用一个 Context。</li>
</ul>
<p>每一个线程都具有一个默认的 Context，无需手动创建，也无法被删除。我们也可以手动创建更多的 Context，使用后需要及时释放。另外，在线程中，默认使用最后一次创建的 Context。</p>


<h3 class="relative group">2.3 Stream 
    <div id="23-stream" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#23-stream" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<p>Stream 主要负责维护一些异步操作的执行顺序，这些操作包括：</p>
<ul>
<li>Host 到 Device 的数据传输；</li>
<li>调用 Kernel；</li>
<li>其它由 Host 发起并由 Device 执行的动作。</li>
</ul>
<blockquote>
<p>说明：在 GPU/NPU 上调用的函数，被称为核函数（Kernel function）。核函数使用 <code>__global__</code> 关键字进行定义，会被 GPU/NPU 上的多个线程执行。</p>
</blockquote>
<p>同一个 Stream 里的操作是严格串行的（顺序执行），而不同 Stream 之间则可以并行执行。来自不同 Stream 的 Kernel 可以共享 GPU/NPU 的内核并发执行。</p>
<p>一般来说，Context 与其它概念之间具有以下关系：</p>
<ul>
<li>一个线程或 Context 中可以创建多个 Stream；</li>
<li>不同线程或 Context 间的 Stream 在 Device 上相互隔离。</li>
</ul>
<p>每一个 Context 都具有一个默认的 Stream，无需手动创建，也无法被删除。我们也可以手动创建更多的 Stream，并将多个操作分配到不同的 Stream 上，这样就可以实现多个操作的并行，Stream 使用后需要及时释放。</p>


<h3 class="relative group">2.4 Task 
    <div id="24-task" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#24-task" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<p>Task 或 Kernel，是 Device 上真正的任务执行体。</p>
<p>一般来说，Task 与其它概念之间具有以下关系：</p>
<ul>
<li>一个 Stream 中可以下发多个 Task；</li>
<li>多个 Task 之间可以插入 Event，用于同步不同 Stream 之间的 Task。</li>
</ul>
<center>
    <img src="./images/算子开发基本概念.png" alt="算子开发基本概念">
</center>
<blockquote>
<p>参考资料：</p>
<ul>
<li><a href="https://www.hiascend.com/doc_center/source/zh/CANNCommunityEdition/80RC3alpha001/devguide/appdevg/aclpythondevg/aclpythondevg_0004.html" target="_blank"><u>Ascend 算子开发基本概念</u></a></li>
<li><a href="https://www.cnblogs.com/LLW-NEU/p/16219611.html" target="_blank"><u>CUDA 基础</u></a></li>
<li><a href="https://juniorprincewang.github.io/2018/01/12/CUDA-logic/" target="_blank"><u>CUDA 介绍</u></a></li>
</ul>
</blockquote>


<h2 class="relative group">三、单算子开发 
    <div id="%E4%B8%89%E5%8D%95%E7%AE%97%E5%AD%90%E5%BC%80%E5%8F%91" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%E4%B8%89%E5%8D%95%E7%AE%97%E5%AD%90%E5%BC%80%E5%8F%91" aria-label="Anchor">#</a>
    </span>        
    
</h2>
<p>官方介绍：</p>
<blockquote>
<p>AscendCL（Ascend Computing Language）是一套用于在昇腾平台上开发深度神经网络应用的 C 语言 API 库，提供运行资源管理、内存管理、模型加载与执行、算子加载与执行、媒体数据处理等 API，能够实现利用昇腾硬件计算资源、在昇腾 CANN 平台上进行深度学习推理计算、图形图像预处理、单算子加速计算等能力。简单来说，就是统一的 API 框架，实现对所有资源的调用。</p>
<p>面向算子开发场景的编程语言 Ascend C，原生支持 C/C++ 标准规范，最大化匹配用户开发习惯；通过多层接口抽象、自动并行计算、孪生调试等关键技术，极大提高算子开发效率，助力 AI 开发者低成本完成算子开发和模型调优部署。</p>
</blockquote>


<h3 class="relative group">3.1 单算子调用方式 
    <div id="31-%E5%8D%95%E7%AE%97%E5%AD%90%E8%B0%83%E7%94%A8%E6%96%B9%E5%BC%8F" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#31-%E5%8D%95%E7%AE%97%E5%AD%90%E8%B0%83%E7%94%A8%E6%96%B9%E5%BC%8F" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<ul>
<li>单算子 API 执行：
<ul>
<li>直接调用 CANN 已经提供的算子 API；</li>
<li>使用 Ascend C 开发并调用自定义算子。</li>
</ul>
</li>
<li>单算子模型执行。</li>
</ul>


<h3 class="relative group">3.2 单算子 API 执行 
    <div id="32-%E5%8D%95%E7%AE%97%E5%AD%90-api-%E6%89%A7%E8%A1%8C" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#32-%E5%8D%95%E7%AE%97%E5%AD%90-api-%E6%89%A7%E8%A1%8C" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<ul>
<li>NN 算子；</li>
<li>DVPP 算子；</li>
<li>融合算子；</li>
<li>……</li>
</ul>
<blockquote>
<p>更详细的算子 API 文档可以参考：<a href="https://www.hiascend.com/document/detail/zh/CANNCommunityEdition/80RC3alpha003/apiref/aolapi/operatorlist_0001.html" target="_blank"><u>算子加速库接口</u></a>。</p>
</blockquote>
<p><strong>两段式接口</strong>：单算子 API 执行时，针对每个算子，都需要依次先调用 <code>aclxxXxxGetWorkspaceSize()</code> 接口获取算子执行需要的 workspace 内存大小、再调用 <code>aclxxXxx()</code> 接口执行算子。</p>
<blockquote>
<p>参考资料：</p>
<ul>
<li><a href="https://www.hiascend.com/document/detail/zh/CANNCommunityEdition/80RC3alpha003/devguide/appdevg/aclcppdevg/aclcppdevg_000016.html" target="_blank"><u>单算子调用基础知识</u></a></li>
<li><a href="https://gitee.com/ascend/cann-ops-adv" target="_blank"><u>Ascend 开源融合算子</u></a></li>
</ul>
</blockquote>


<h2 class="relative group">四、代码实现 
    <div id="%E5%9B%9B%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%E5%9B%9B%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0" aria-label="Anchor">#</a>
    </span>        
    
</h2>
<p>本小节将以 <code>aclnnAdd</code> 和 <code>aclnnMatmul</code> 算子为例，实现具体的代码。</p>
<blockquote>
<p>更详细的 API 文档可以参考：</p>
<ul>
<li>加法算子：<a href="https://www.hiascend.com/document/detail/zh/CANNCommunityEdition/80RC3alpha003/apiref/aolapi/context/common/aclnn_domains.md?sub_id=%2Fzh%2FCANNCommunityEdition%2F80RC3alpha003%2Fapiref%2Faolapi%2Fcontext%2FaclnnAdd%26aclnnInplaceAdd.md" target="_blank"><u>aclnnAdd</u></a></li>
<li>乘法算子：<a href="https://www.hiascend.com/document/detail/zh/CANNCommunityEdition/80RC3alpha003/apiref/aolapi/context/aclnnMatmul.md" target="_blank"><u>aclnnMatmul</u></a></li>
</ul>
</blockquote>


<h3 class="relative group">4.1 环境搭建 
    <div id="41-%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#41-%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<ul>
<li><a href="https://ascend.github.io/docs/sources/ascend/quick_install.html" target="_blank"><u>快速安装昇腾环境</u></a></li>
<li><a href="https://blog.csdn.net/weixin_44162047/article/details/142502025?spm=1001.2014.3001.5502" target="_blank"><u>基于 EulerOS &amp; Ascend NPU 搭建 PyTorch 远程开发环境</u></a></li>
</ul>


<h3 class="relative group">4.2 单算子开发流程 
    <div id="42-%E5%8D%95%E7%AE%97%E5%AD%90%E5%BC%80%E5%8F%91%E6%B5%81%E7%A8%8B" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#42-%E5%8D%95%E7%AE%97%E5%AD%90%E5%BC%80%E5%8F%91%E6%B5%81%E7%A8%8B" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<center>
    <img src="./images/单算子调用功能开发流程.png" alt="单算子调用功能开发流程">
    <img src="./images/单算子API调用流程.png" alt="单算子API调用流程">
</center>


<h3 class="relative group">4.3 常见参数说明 
    <div id="43-%E5%B8%B8%E8%A7%81%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#43-%E5%B8%B8%E8%A7%81%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<ul>
<li><code>strides</code>：描述 Tensor 维度上相邻两个元素的间隔，详见<a href="https://www.hiascend.com/document/detail/zh/CANNCommunityEdition/80RC3alpha003/apiref/aolapi/context/common/%E9%9D%9E%E8%BF%9E%E7%BB%AD%E7%9A%84Tensor.md" target="_blank"><u>非连续的 Tensor</u></a>；</li>
<li><code>workspace</code>：在 device 侧申请的 workspace 内存地址；</li>
<li><code>workspaceSize</code>：在 device 侧申请的 workspace 大小；</li>
<li><code>executor</code>：算子执行器，实现了算子的计算流程；</li>
<li><code>aclnnStatus</code>：详见<a href="https://www.hiascend.com/document/detail/zh/CANNCommunityEdition/80RC3alpha003/apiref/aolapi/context/common/aclnn%E8%BF%94%E5%9B%9E%E7%A0%81.md" target="_blank"><u>aclnn 返回码</u></a>。</li>
</ul>
<blockquote>
<p>注意：</p>
<ul>
<li>多个输入数据之间，数据类型需要满足<a href="https://www.hiascend.com/document/detail/zh/CANNCommunityEdition/80RC3alpha003/apiref/aolapi/context/common/%E4%BA%92%E6%8E%A8%E5%AF%BC%E5%85%B3%E7%B3%BB.md" target="_blank"><u>互推导关系</u></a>：当一个 API（如 <code>aclnnAdd()</code>、<code>aclnnMul()</code> 等）输入的 Tensor 数据类型不一致时，API 内部会推导出一个数据类型，将输入数据转换成该数据类型进行计算；</li>
<li>多个输入数据之间，shape 需要满足<a href="https://www.hiascend.com/document/detail/zh/CANNCommunityEdition/80RC3alpha003/apiref/aolapi/context/common/broadcast%E5%85%B3%E7%B3%BB.md" target="_blank"><u>广播关系</u></a>：在某些情况下，较小的数组可以“广播至”较大的数组，使两者shape互相兼容；</li>
<li>更多算子 API 信息详见：<a href="https://www.hiascend.com/document/detail/zh/CANNCommunityEdition/80RC3alpha003/quickstart/quickstart/quickstart_18_0001.html" target="_blank"><u>CANN 社区版开发文档</u></a>，位置：【CANN 社区版 -&gt; 8.0.RC3.alpha003 -&gt; API 参考 -&gt; 算子加速库接口 -&gt; NN 算子接口】。</li>
</ul>
</blockquote>


<h3 class="relative group">4.4 矩阵加法算子 
    <div id="44-%E7%9F%A9%E9%98%B5%E5%8A%A0%E6%B3%95%E7%AE%97%E5%AD%90" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#44-%E7%9F%A9%E9%98%B5%E5%8A%A0%E6%B3%95%E7%AE%97%E5%AD%90" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<p>目录结构：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">sss@xxx:~/xxx/add$ tree
</span></span><span class="line"><span class="cl">.
</span></span><span class="line"><span class="cl"><span class="p">|</span>-- CMakeLists.txt
</span></span><span class="line"><span class="cl"><span class="p">|</span>-- build
</span></span><span class="line"><span class="cl"><span class="sb">`</span>-- test_add.cpp
</span></span></code></pre></div><p>CMakeLists：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># Copyright (c) Huawei Technologies Co., Ltd. 2019. All rights reserved.</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># CMake lowest version requirement</span>
</span></span><span class="line"><span class="cl">cmake_minimum_required<span class="o">(</span>VERSION 3.14<span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 设置工程名</span>
</span></span><span class="line"><span class="cl">project<span class="o">(</span>ACLNN_EXAMPLE<span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Compile options</span>
</span></span><span class="line"><span class="cl">add_compile_options<span class="o">(</span>-std<span class="o">=</span>c++11<span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 设置编译选项</span>
</span></span><span class="line"><span class="cl">set<span class="o">(</span>CMAKE_RUNTIME_OUTPUT_DIRECTORY  <span class="s2">&#34;./bin&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">set<span class="o">(</span>CMAKE_CXX_FLAGS_DEBUG <span class="s2">&#34;-fPIC -O0 -g -Wall&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">set<span class="o">(</span>CMAKE_CXX_FLAGS_RELEASE <span class="s2">&#34;-fPIC -O2 -Wall&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 设置可执行文件名（如opapi_test），并指定待运行算子文件*.cpp所在目录</span>
</span></span><span class="line"><span class="cl">add_executable<span class="o">(</span>opapi_add_test
</span></span><span class="line"><span class="cl">               ../test_add.cpp<span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 设置ASCEND_PATH（CANN软件包目录，请根据实际路径修改）和INCLUDE_BASE_DIR（头文件目录）</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span><span class="o">(</span>NOT <span class="s2">&#34;</span><span class="nv">$ENV</span><span class="s2">{ASCEND_CUSTOM_PATH}&#34;</span> STREQUAL <span class="s2">&#34;&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    set<span class="o">(</span>ASCEND_PATH <span class="nv">$ENV</span><span class="o">{</span>ASCEND_CUSTOM_PATH<span class="o">})</span>
</span></span><span class="line"><span class="cl"><span class="k">else</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">    set<span class="o">(</span>ASCEND_PATH <span class="s2">&#34;/home/sss/Ascend/ascend-toolkit/latest&#34;</span><span class="o">)</span>  <span class="c1"># 示例：/usr/local/Ascend/ascend-toolkit/latest</span>
</span></span><span class="line"><span class="cl">endif<span class="o">()</span>
</span></span><span class="line"><span class="cl">set<span class="o">(</span>INCLUDE_BASE_DIR <span class="s2">&#34;</span><span class="si">${</span><span class="nv">ASCEND_PATH</span><span class="si">}</span><span class="s2">/include&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">include_directories<span class="o">(</span>
</span></span><span class="line"><span class="cl">    <span class="si">${</span><span class="nv">INCLUDE_BASE_DIR</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">    <span class="si">${</span><span class="nv">INCLUDE_BASE_DIR</span><span class="si">}</span>/aclnn
</span></span><span class="line"><span class="cl"><span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 设置链接的动态库文件路径</span>
</span></span><span class="line"><span class="cl"><span class="c1"># arch表示操作系统架构，os表示操作系统</span>
</span></span><span class="line"><span class="cl">target_link_libraries<span class="o">(</span>opapi_test PRIVATE
</span></span><span class="line"><span class="cl">                      <span class="si">${</span><span class="nv">ASCEND_PATH</span><span class="si">}</span>/lib64/libascendcl.so
</span></span><span class="line"><span class="cl">                      <span class="si">${</span><span class="nv">ASCEND_PATH</span><span class="si">}</span>/lib64/libnnopbase.so
</span></span><span class="line"><span class="cl">                      <span class="si">${</span><span class="nv">ASCEND_PATH</span><span class="si">}</span>/lib64/libopapi.so<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 可执行文件在CMakeLists文件所在目录的bin目录下</span>
</span></span><span class="line"><span class="cl">install<span class="o">(</span>TARGETS opapi_test DESTINATION <span class="si">${</span><span class="nv">CMAKE_RUNTIME_OUTPUT_DIRECTORY</span><span class="si">}</span><span class="o">)</span>
</span></span></code></pre></div><p>编译构建：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">mkdir build
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> build
</span></span><span class="line"><span class="cl">cmake .. -DCMAKE_CXX_COMPILER<span class="o">=</span>g++ -DCMAKE_SKIP_RPATH<span class="o">=</span>TRUE
</span></span><span class="line"><span class="cl">make
</span></span></code></pre></div><p><code>test_add</code> 代码：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;vector&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&#34;acl/acl.h&#34;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&#34;aclnnop/aclnn_add.h&#34;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="cp">#define CHECK_RET(cond, return_expr) \
</span></span></span><span class="line"><span class="cl"><span class="cp">  do {                               \
</span></span></span><span class="line"><span class="cl"><span class="cp">    if (!(cond)) {                   \
</span></span></span><span class="line"><span class="cl"><span class="cp">      return_expr;                   \
</span></span></span><span class="line"><span class="cl"><span class="cp">    }                                \
</span></span></span><span class="line"><span class="cl"><span class="cp">  } while (0)
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="cp">#define LOG_PRINT(message, ...)     \
</span></span></span><span class="line"><span class="cl"><span class="cp">  do {                              \
</span></span></span><span class="line"><span class="cl"><span class="cp">    printf(message, ##__VA_ARGS__); \
</span></span></span><span class="line"><span class="cl"><span class="cp">  } while (0)
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">int64_t</span> <span class="nf">GetShapeSize</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int64_t</span><span class="o">&gt;&amp;</span> <span class="n">shape</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kt">int64_t</span> <span class="n">shape_size</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="nl">i</span> <span class="p">:</span> <span class="n">shape</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">shape_size</span> <span class="o">*=</span> <span class="n">i</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="n">shape_size</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">Init</span><span class="p">(</span><span class="kt">int32_t</span> <span class="n">deviceId</span><span class="p">,</span> <span class="n">aclrtStream</span><span class="o">*</span> <span class="n">stream</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// 固定写法，AscendCL初始化
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">auto</span> <span class="n">ret</span> <span class="o">=</span> <span class="n">aclInit</span><span class="p">(</span><span class="k">nullptr</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">CHECK_RET</span><span class="p">(</span><span class="n">ret</span> <span class="o">==</span> <span class="n">ACL_SUCCESS</span><span class="p">,</span> <span class="n">LOG_PRINT</span><span class="p">(</span><span class="s">&#34;aclInit failed. ERROR: %d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">ret</span><span class="p">);</span> <span class="k">return</span> <span class="n">ret</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">ret</span> <span class="o">=</span> <span class="n">aclrtSetDevice</span><span class="p">(</span><span class="n">deviceId</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">CHECK_RET</span><span class="p">(</span><span class="n">ret</span> <span class="o">==</span> <span class="n">ACL_SUCCESS</span><span class="p">,</span> <span class="n">LOG_PRINT</span><span class="p">(</span><span class="s">&#34;aclrtSetDevice failed. ERROR: %d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">ret</span><span class="p">);</span> <span class="k">return</span> <span class="n">ret</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">ret</span> <span class="o">=</span> <span class="n">aclrtCreateStream</span><span class="p">(</span><span class="n">stream</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">CHECK_RET</span><span class="p">(</span><span class="n">ret</span> <span class="o">==</span> <span class="n">ACL_SUCCESS</span><span class="p">,</span> <span class="n">LOG_PRINT</span><span class="p">(</span><span class="s">&#34;aclrtCreateStream failed. ERROR: %d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">ret</span><span class="p">);</span> <span class="k">return</span> <span class="n">ret</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">CreateAclTensor</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&amp;</span> <span class="n">hostData</span><span class="p">,</span> <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int64_t</span><span class="o">&gt;&amp;</span> <span class="n">shape</span><span class="p">,</span> <span class="kt">void</span><span class="o">**</span> <span class="n">deviceAddr</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="n">aclDataType</span> <span class="n">dataType</span><span class="p">,</span> <span class="n">aclTensor</span><span class="o">**</span> <span class="n">tensor</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">auto</span> <span class="n">size</span> <span class="o">=</span> <span class="n">GetShapeSize</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">T</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// 调用aclrtMalloc申请device侧内存
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">auto</span> <span class="n">ret</span> <span class="o">=</span> <span class="n">aclrtMalloc</span><span class="p">(</span><span class="n">deviceAddr</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">ACL_MEM_MALLOC_HUGE_FIRST</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">CHECK_RET</span><span class="p">(</span><span class="n">ret</span> <span class="o">==</span> <span class="n">ACL_SUCCESS</span><span class="p">,</span> <span class="n">LOG_PRINT</span><span class="p">(</span><span class="s">&#34;aclrtMalloc failed. ERROR: %d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">ret</span><span class="p">);</span> <span class="k">return</span> <span class="n">ret</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// 调用aclrtMemcpy将host侧数据拷贝到device侧内存上
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">ret</span> <span class="o">=</span> <span class="n">aclrtMemcpy</span><span class="p">(</span><span class="o">*</span><span class="n">deviceAddr</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">hostData</span><span class="p">.</span><span class="n">data</span><span class="p">(),</span> <span class="n">size</span><span class="p">,</span> <span class="n">ACL_MEMCPY_HOST_TO_DEVICE</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">CHECK_RET</span><span class="p">(</span><span class="n">ret</span> <span class="o">==</span> <span class="n">ACL_SUCCESS</span><span class="p">,</span> <span class="n">LOG_PRINT</span><span class="p">(</span><span class="s">&#34;aclrtMemcpy failed. ERROR: %d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">ret</span><span class="p">);</span> <span class="k">return</span> <span class="n">ret</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// 计算连续tensor的strides
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int64_t</span><span class="o">&gt;</span> <span class="n">strides</span><span class="p">(</span><span class="n">shape</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="kt">int64_t</span> <span class="n">i</span> <span class="o">=</span> <span class="n">shape</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">-</span> <span class="mi">2</span><span class="p">;</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">strides</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">shape</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">strides</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// 调用aclCreateTensor接口创建aclTensor
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="o">*</span><span class="n">tensor</span> <span class="o">=</span> <span class="n">aclCreateTensor</span><span class="p">(</span><span class="n">shape</span><span class="p">.</span><span class="n">data</span><span class="p">(),</span> <span class="n">shape</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">dataType</span><span class="p">,</span> <span class="n">strides</span><span class="p">.</span><span class="n">data</span><span class="p">(),</span> <span class="mi">0</span><span class="p">,</span> <span class="n">aclFormat</span><span class="o">::</span><span class="n">ACL_FORMAT_ND</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                            <span class="n">shape</span><span class="p">.</span><span class="n">data</span><span class="p">(),</span> <span class="n">shape</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="o">*</span><span class="n">deviceAddr</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// 1. （固定写法）device/stream初始化, 参考AscendCL对外接口列表
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="c1">// 根据自己的实际device填写deviceId
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">int32_t</span> <span class="n">deviceId</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">aclrtStream</span> <span class="n">stream</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">auto</span> <span class="n">ret</span> <span class="o">=</span> <span class="n">Init</span><span class="p">(</span><span class="n">deviceId</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">stream</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// check根据自己的需要处理
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">CHECK_RET</span><span class="p">(</span><span class="n">ret</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="n">LOG_PRINT</span><span class="p">(</span><span class="s">&#34;Init acl failed. ERROR: %d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">ret</span><span class="p">);</span> <span class="k">return</span> <span class="n">ret</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// 2. 构造输入与输出，需要根据API的接口自定义构造
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int64_t</span><span class="o">&gt;</span> <span class="n">selfShape</span> <span class="o">=</span> <span class="p">{</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">};</span>
</span></span><span class="line"><span class="cl">  <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int64_t</span><span class="o">&gt;</span> <span class="n">otherShape</span> <span class="o">=</span> <span class="p">{</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">};</span>
</span></span><span class="line"><span class="cl">  <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int64_t</span><span class="o">&gt;</span> <span class="n">outShape</span> <span class="o">=</span> <span class="p">{</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">};</span>
</span></span><span class="line"><span class="cl">  <span class="kt">void</span><span class="o">*</span> <span class="n">selfDeviceAddr</span> <span class="o">=</span> <span class="k">nullptr</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="kt">void</span><span class="o">*</span> <span class="n">otherDeviceAddr</span> <span class="o">=</span> <span class="k">nullptr</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="kt">void</span><span class="o">*</span> <span class="n">outDeviceAddr</span> <span class="o">=</span> <span class="k">nullptr</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">aclTensor</span><span class="o">*</span> <span class="n">self</span> <span class="o">=</span> <span class="k">nullptr</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">aclTensor</span><span class="o">*</span> <span class="n">other</span> <span class="o">=</span> <span class="k">nullptr</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">aclScalar</span><span class="o">*</span> <span class="n">alpha</span> <span class="o">=</span> <span class="k">nullptr</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">aclTensor</span><span class="o">*</span> <span class="n">out</span> <span class="o">=</span> <span class="k">nullptr</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="n">selfHostData</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">};</span>
</span></span><span class="line"><span class="cl">  <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="n">otherHostData</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">};</span>
</span></span><span class="line"><span class="cl">  <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="n">outHostData</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">};</span>
</span></span><span class="line"><span class="cl">  <span class="kt">float</span> <span class="n">alphaValue</span> <span class="o">=</span> <span class="mf">1.2f</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// 创建self aclTensor
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">ret</span> <span class="o">=</span> <span class="n">CreateAclTensor</span><span class="p">(</span><span class="n">selfHostData</span><span class="p">,</span> <span class="n">selfShape</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">selfDeviceAddr</span><span class="p">,</span> <span class="n">aclDataType</span><span class="o">::</span><span class="n">ACL_FLOAT</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">self</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">CHECK_RET</span><span class="p">(</span><span class="n">ret</span> <span class="o">==</span> <span class="n">ACL_SUCCESS</span><span class="p">,</span> <span class="k">return</span> <span class="n">ret</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// 创建other aclTensor
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">ret</span> <span class="o">=</span> <span class="n">CreateAclTensor</span><span class="p">(</span><span class="n">otherHostData</span><span class="p">,</span> <span class="n">otherShape</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">otherDeviceAddr</span><span class="p">,</span> <span class="n">aclDataType</span><span class="o">::</span><span class="n">ACL_FLOAT</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">other</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">CHECK_RET</span><span class="p">(</span><span class="n">ret</span> <span class="o">==</span> <span class="n">ACL_SUCCESS</span><span class="p">,</span> <span class="k">return</span> <span class="n">ret</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// 创建alpha aclScalar
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">alpha</span> <span class="o">=</span> <span class="n">aclCreateScalar</span><span class="p">(</span><span class="o">&amp;</span><span class="n">alphaValue</span><span class="p">,</span> <span class="n">aclDataType</span><span class="o">::</span><span class="n">ACL_FLOAT</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">CHECK_RET</span><span class="p">(</span><span class="n">alpha</span> <span class="o">!=</span> <span class="k">nullptr</span><span class="p">,</span> <span class="k">return</span> <span class="n">ret</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// 创建out aclTensor
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">ret</span> <span class="o">=</span> <span class="n">CreateAclTensor</span><span class="p">(</span><span class="n">outHostData</span><span class="p">,</span> <span class="n">outShape</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">outDeviceAddr</span><span class="p">,</span> <span class="n">aclDataType</span><span class="o">::</span><span class="n">ACL_FLOAT</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">out</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">CHECK_RET</span><span class="p">(</span><span class="n">ret</span> <span class="o">==</span> <span class="n">ACL_SUCCESS</span><span class="p">,</span> <span class="k">return</span> <span class="n">ret</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// 3. 调用CANN算子库API，需要修改为具体的算子接口
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">uint64_t</span> <span class="n">workspaceSize</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">aclOpExecutor</span><span class="o">*</span> <span class="n">executor</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// 调用aclnnAdd第一段接口
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">ret</span> <span class="o">=</span> <span class="n">aclnnAddGetWorkspaceSize</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">workspaceSize</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">executor</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">CHECK_RET</span><span class="p">(</span><span class="n">ret</span> <span class="o">==</span> <span class="n">ACL_SUCCESS</span><span class="p">,</span> <span class="n">LOG_PRINT</span><span class="p">(</span><span class="s">&#34;aclnnAddGetWorkspaceSize failed. ERROR: %d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">ret</span><span class="p">);</span> <span class="k">return</span> <span class="n">ret</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// 根据第一段接口计算出的workspaceSize申请device内存
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">void</span><span class="o">*</span> <span class="n">workspaceAddr</span> <span class="o">=</span> <span class="k">nullptr</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="n">workspaceSize</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">ret</span> <span class="o">=</span> <span class="n">aclrtMalloc</span><span class="p">(</span><span class="o">&amp;</span><span class="n">workspaceAddr</span><span class="p">,</span> <span class="n">workspaceSize</span><span class="p">,</span> <span class="n">ACL_MEM_MALLOC_HUGE_FIRST</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">CHECK_RET</span><span class="p">(</span><span class="n">ret</span> <span class="o">==</span> <span class="n">ACL_SUCCESS</span><span class="p">,</span> <span class="n">LOG_PRINT</span><span class="p">(</span><span class="s">&#34;allocate workspace failed. ERROR: %d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">ret</span><span class="p">);</span> <span class="k">return</span> <span class="n">ret</span><span class="p">;);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// 调用aclnnAdd第二段接口
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">ret</span> <span class="o">=</span> <span class="n">aclnnAdd</span><span class="p">(</span><span class="n">workspaceAddr</span><span class="p">,</span> <span class="n">workspaceSize</span><span class="p">,</span> <span class="n">executor</span><span class="p">,</span> <span class="n">stream</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">CHECK_RET</span><span class="p">(</span><span class="n">ret</span> <span class="o">==</span> <span class="n">ACL_SUCCESS</span><span class="p">,</span> <span class="n">LOG_PRINT</span><span class="p">(</span><span class="s">&#34;aclnnAdd failed. ERROR: %d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">ret</span><span class="p">);</span> <span class="k">return</span> <span class="n">ret</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// 4.（ 固定写法）同步等待任务执行结束
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">ret</span> <span class="o">=</span> <span class="n">aclrtSynchronizeStream</span><span class="p">(</span><span class="n">stream</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">CHECK_RET</span><span class="p">(</span><span class="n">ret</span> <span class="o">==</span> <span class="n">ACL_SUCCESS</span><span class="p">,</span> <span class="n">LOG_PRINT</span><span class="p">(</span><span class="s">&#34;aclrtSynchronizeStream failed. ERROR: %d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">ret</span><span class="p">);</span> <span class="k">return</span> <span class="n">ret</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// 5. 获取输出的值，将device侧内存上的结果拷贝至host侧，需要根据具体API的接口定义修改
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">auto</span> <span class="n">size</span> <span class="o">=</span> <span class="n">GetShapeSize</span><span class="p">(</span><span class="n">outShape</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="n">resultData</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">ret</span> <span class="o">=</span> <span class="n">aclrtMemcpy</span><span class="p">(</span><span class="n">resultData</span><span class="p">.</span><span class="n">data</span><span class="p">(),</span> <span class="n">resultData</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">resultData</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">outDeviceAddr</span><span class="p">,</span> <span class="n">size</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">float</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                    <span class="n">ACL_MEMCPY_DEVICE_TO_HOST</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">CHECK_RET</span><span class="p">(</span><span class="n">ret</span> <span class="o">==</span> <span class="n">ACL_SUCCESS</span><span class="p">,</span> <span class="n">LOG_PRINT</span><span class="p">(</span><span class="s">&#34;copy result from device to host failed. ERROR: %d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">ret</span><span class="p">);</span> <span class="k">return</span> <span class="n">ret</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="kt">int64_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">size</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">LOG_PRINT</span><span class="p">(</span><span class="s">&#34;result[%ld] is: %f</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">resultData</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// 6. 释放aclTensor和aclScalar，需要根据具体API的接口定义修改
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">aclDestroyTensor</span><span class="p">(</span><span class="n">self</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">aclDestroyTensor</span><span class="p">(</span><span class="n">other</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">aclDestroyScalar</span><span class="p">(</span><span class="n">alpha</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">aclDestroyTensor</span><span class="p">(</span><span class="n">out</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">  <span class="c1">// 7. 释放device资源，需要根据具体API的接口定义修改
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">aclrtFree</span><span class="p">(</span><span class="n">selfDeviceAddr</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">aclrtFree</span><span class="p">(</span><span class="n">otherDeviceAddr</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">aclrtFree</span><span class="p">(</span><span class="n">outDeviceAddr</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="n">workspaceSize</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">aclrtFree</span><span class="p">(</span><span class="n">workspaceAddr</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="n">aclrtDestroyStream</span><span class="p">(</span><span class="n">stream</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">aclrtResetDevice</span><span class="p">(</span><span class="n">deviceId</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">aclFinalize</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>运行程序：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">./opapi_add_test
</span></span></code></pre></div><p>运行结果：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">sss@xxx:~/xxx/add/build/bin$ ./opapi_test 
</span></span><span class="line"><span class="cl">result<span class="o">[</span>0<span class="o">]</span> is: 1.200000
</span></span><span class="line"><span class="cl">result<span class="o">[</span>1<span class="o">]</span> is: 2.200000
</span></span><span class="line"><span class="cl">result<span class="o">[</span>2<span class="o">]</span> is: 3.200000
</span></span><span class="line"><span class="cl">result<span class="o">[</span>3<span class="o">]</span> is: 5.400000
</span></span><span class="line"><span class="cl">result<span class="o">[</span>4<span class="o">]</span> is: 6.400000
</span></span><span class="line"><span class="cl">result<span class="o">[</span>5<span class="o">]</span> is: 7.400000
</span></span><span class="line"><span class="cl">result<span class="o">[</span>6<span class="o">]</span> is: 9.600000
</span></span><span class="line"><span class="cl">result<span class="o">[</span>7<span class="o">]</span> is: 10.600000
</span></span></code></pre></div>

<h3 class="relative group">4.5 矩阵乘法算子 
    <div id="45-%E7%9F%A9%E9%98%B5%E4%B9%98%E6%B3%95%E7%AE%97%E5%AD%90" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#45-%E7%9F%A9%E9%98%B5%E4%B9%98%E6%B3%95%E7%AE%97%E5%AD%90" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<p>目录结构：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">sss@xxx:~/xxx/mul$ tree
</span></span><span class="line"><span class="cl">.
</span></span><span class="line"><span class="cl"><span class="p">|</span>-- CMakeLists.txt
</span></span><span class="line"><span class="cl"><span class="p">|</span>-- build
</span></span><span class="line"><span class="cl"><span class="sb">`</span>-- test_mul.cpp
</span></span></code></pre></div><p>CMakeLists：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># Copyright (c) Huawei Technologies Co., Ltd. 2019. All rights reserved.</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># CMake lowest version requirement</span>
</span></span><span class="line"><span class="cl">cmake_minimum_required<span class="o">(</span>VERSION 3.14<span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 设置工程名</span>
</span></span><span class="line"><span class="cl">project<span class="o">(</span>ACLNN_EXAMPLE<span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Compile options</span>
</span></span><span class="line"><span class="cl">add_compile_options<span class="o">(</span>-std<span class="o">=</span>c++11<span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 设置编译选项</span>
</span></span><span class="line"><span class="cl">set<span class="o">(</span>CMAKE_RUNTIME_OUTPUT_DIRECTORY  <span class="s2">&#34;./bin&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">set<span class="o">(</span>CMAKE_CXX_FLAGS_DEBUG <span class="s2">&#34;-fPIC -O0 -g -Wall&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">set<span class="o">(</span>CMAKE_CXX_FLAGS_RELEASE <span class="s2">&#34;-fPIC -O2 -Wall&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 设置可执行文件名（如opapi_test），并指定待运行算子文件*.cpp所在目录</span>
</span></span><span class="line"><span class="cl">add_executable<span class="o">(</span>opapi_mul_test
</span></span><span class="line"><span class="cl">               ../test_mul.cpp<span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 设置ASCEND_PATH（CANN软件包目录，请根据实际路径修改）和INCLUDE_BASE_DIR（头文件目录）</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span><span class="o">(</span>NOT <span class="s2">&#34;</span><span class="nv">$ENV</span><span class="s2">{ASCEND_CUSTOM_PATH}&#34;</span> STREQUAL <span class="s2">&#34;&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    set<span class="o">(</span>ASCEND_PATH <span class="nv">$ENV</span><span class="o">{</span>ASCEND_CUSTOM_PATH<span class="o">})</span>
</span></span><span class="line"><span class="cl"><span class="k">else</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">    set<span class="o">(</span>ASCEND_PATH <span class="s2">&#34;/home/sss/Ascend/ascend-toolkit/latest&#34;</span><span class="o">)</span>  <span class="c1"># 示例：/usr/local/Ascend/ascend-toolkit/latest</span>
</span></span><span class="line"><span class="cl">endif<span class="o">()</span>
</span></span><span class="line"><span class="cl">set<span class="o">(</span>INCLUDE_BASE_DIR <span class="s2">&#34;</span><span class="si">${</span><span class="nv">ASCEND_PATH</span><span class="si">}</span><span class="s2">/include&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">include_directories<span class="o">(</span>
</span></span><span class="line"><span class="cl">    <span class="si">${</span><span class="nv">INCLUDE_BASE_DIR</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">    <span class="si">${</span><span class="nv">INCLUDE_BASE_DIR</span><span class="si">}</span>/aclnn
</span></span><span class="line"><span class="cl"><span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 设置链接的动态库文件路径</span>
</span></span><span class="line"><span class="cl"><span class="c1"># arch表示操作系统架构，os表示操作系统</span>
</span></span><span class="line"><span class="cl">target_link_libraries<span class="o">(</span>opapi_test PRIVATE
</span></span><span class="line"><span class="cl">                      <span class="si">${</span><span class="nv">ASCEND_PATH</span><span class="si">}</span>/lib64/libascendcl.so
</span></span><span class="line"><span class="cl">                      <span class="si">${</span><span class="nv">ASCEND_PATH</span><span class="si">}</span>/lib64/libnnopbase.so
</span></span><span class="line"><span class="cl">                      <span class="si">${</span><span class="nv">ASCEND_PATH</span><span class="si">}</span>/lib64/libopapi.so<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 可执行文件在CMakeLists文件所在目录的bin目录下</span>
</span></span><span class="line"><span class="cl">install<span class="o">(</span>TARGETS opapi_test DESTINATION <span class="si">${</span><span class="nv">CMAKE_RUNTIME_OUTPUT_DIRECTORY</span><span class="si">}</span><span class="o">)</span>
</span></span></code></pre></div><p>编译构建：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">mkdir build
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> build
</span></span><span class="line"><span class="cl">cmake .. -DCMAKE_CXX_COMPILER<span class="o">=</span>g++ -DCMAKE_SKIP_RPATH<span class="o">=</span>TRUE
</span></span><span class="line"><span class="cl">make
</span></span></code></pre></div><p><code>test_mul</code> 代码：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;vector&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&#34;acl/acl.h&#34;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&#34;aclnnop/aclnn_matmul.h&#34;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="cp">#define CHECK_RET(cond, return_expr) \
</span></span></span><span class="line"><span class="cl"><span class="cp">  do {                               \
</span></span></span><span class="line"><span class="cl"><span class="cp">    if (!(cond)) {                   \
</span></span></span><span class="line"><span class="cl"><span class="cp">      return_expr;                   \
</span></span></span><span class="line"><span class="cl"><span class="cp">    }                                \
</span></span></span><span class="line"><span class="cl"><span class="cp">  } while (0)
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="cp">#define LOG_PRINT(message, ...)     \
</span></span></span><span class="line"><span class="cl"><span class="cp">  do {                              \
</span></span></span><span class="line"><span class="cl"><span class="cp">    printf(message, ##__VA_ARGS__); \
</span></span></span><span class="line"><span class="cl"><span class="cp">  } while (0)
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">int64_t</span> <span class="nf">GetShapeSize</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int64_t</span><span class="o">&gt;&amp;</span> <span class="n">shape</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kt">int64_t</span> <span class="n">shape_size</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="nl">i</span> <span class="p">:</span> <span class="n">shape</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">shape_size</span> <span class="o">*=</span> <span class="n">i</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="n">shape_size</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">Init</span><span class="p">(</span><span class="kt">int32_t</span> <span class="n">deviceId</span><span class="p">,</span> <span class="n">aclrtStream</span><span class="o">*</span> <span class="n">stream</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// 固定写法，AscendCL初始化
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">auto</span> <span class="n">ret</span> <span class="o">=</span> <span class="n">aclInit</span><span class="p">(</span><span class="k">nullptr</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">CHECK_RET</span><span class="p">(</span><span class="n">ret</span> <span class="o">==</span> <span class="n">ACL_SUCCESS</span><span class="p">,</span> <span class="n">LOG_PRINT</span><span class="p">(</span><span class="s">&#34;aclInit failed. ERROR: %d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">ret</span><span class="p">);</span> <span class="k">return</span> <span class="n">ret</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">ret</span> <span class="o">=</span> <span class="n">aclrtSetDevice</span><span class="p">(</span><span class="n">deviceId</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">CHECK_RET</span><span class="p">(</span><span class="n">ret</span> <span class="o">==</span> <span class="n">ACL_SUCCESS</span><span class="p">,</span> <span class="n">LOG_PRINT</span><span class="p">(</span><span class="s">&#34;aclrtSetDevice failed. ERROR: %d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">ret</span><span class="p">);</span> <span class="k">return</span> <span class="n">ret</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">ret</span> <span class="o">=</span> <span class="n">aclrtCreateStream</span><span class="p">(</span><span class="n">stream</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">CHECK_RET</span><span class="p">(</span><span class="n">ret</span> <span class="o">==</span> <span class="n">ACL_SUCCESS</span><span class="p">,</span> <span class="n">LOG_PRINT</span><span class="p">(</span><span class="s">&#34;aclrtCreateStream failed. ERROR: %d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">ret</span><span class="p">);</span> <span class="k">return</span> <span class="n">ret</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">CreateAclTensor</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&amp;</span> <span class="n">hostData</span><span class="p">,</span> <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int64_t</span><span class="o">&gt;&amp;</span> <span class="n">shape</span><span class="p">,</span> <span class="kt">void</span><span class="o">**</span> <span class="n">deviceAddr</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="n">aclDataType</span> <span class="n">dataType</span><span class="p">,</span> <span class="n">aclTensor</span><span class="o">**</span> <span class="n">tensor</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">auto</span> <span class="n">size</span> <span class="o">=</span> <span class="n">GetShapeSize</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">T</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// 调用aclrtMalloc申请device侧内存
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">auto</span> <span class="n">ret</span> <span class="o">=</span> <span class="n">aclrtMalloc</span><span class="p">(</span><span class="n">deviceAddr</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">ACL_MEM_MALLOC_HUGE_FIRST</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">CHECK_RET</span><span class="p">(</span><span class="n">ret</span> <span class="o">==</span> <span class="n">ACL_SUCCESS</span><span class="p">,</span> <span class="n">LOG_PRINT</span><span class="p">(</span><span class="s">&#34;aclrtMalloc failed. ERROR: %d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">ret</span><span class="p">);</span> <span class="k">return</span> <span class="n">ret</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// 调用aclrtMemcpy将host侧数据拷贝到device侧内存上
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">ret</span> <span class="o">=</span> <span class="n">aclrtMemcpy</span><span class="p">(</span><span class="o">*</span><span class="n">deviceAddr</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">hostData</span><span class="p">.</span><span class="n">data</span><span class="p">(),</span> <span class="n">size</span><span class="p">,</span> <span class="n">ACL_MEMCPY_HOST_TO_DEVICE</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">CHECK_RET</span><span class="p">(</span><span class="n">ret</span> <span class="o">==</span> <span class="n">ACL_SUCCESS</span><span class="p">,</span> <span class="n">LOG_PRINT</span><span class="p">(</span><span class="s">&#34;aclrtMemcpy failed. ERROR: %d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">ret</span><span class="p">);</span> <span class="k">return</span> <span class="n">ret</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// 计算连续tensor的strides
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int64_t</span><span class="o">&gt;</span> <span class="n">strides</span><span class="p">(</span><span class="n">shape</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="kt">int64_t</span> <span class="n">i</span> <span class="o">=</span> <span class="n">shape</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">-</span> <span class="mi">2</span><span class="p">;</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">strides</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">shape</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">strides</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// 调用aclCreateTensor接口创建aclTensor
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="o">*</span><span class="n">tensor</span> <span class="o">=</span> <span class="n">aclCreateTensor</span><span class="p">(</span><span class="n">shape</span><span class="p">.</span><span class="n">data</span><span class="p">(),</span> <span class="n">shape</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">dataType</span><span class="p">,</span> <span class="n">strides</span><span class="p">.</span><span class="n">data</span><span class="p">(),</span> <span class="mi">0</span><span class="p">,</span> <span class="n">aclFormat</span><span class="o">::</span><span class="n">ACL_FORMAT_ND</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                            <span class="n">shape</span><span class="p">.</span><span class="n">data</span><span class="p">(),</span> <span class="n">shape</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="o">*</span><span class="n">deviceAddr</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// 1.初始化
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">int32_t</span> <span class="n">deviceId</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">aclrtStream</span> <span class="n">stream</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">auto</span> <span class="n">ret</span> <span class="o">=</span> <span class="n">Init</span><span class="p">(</span><span class="n">deviceId</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">stream</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">CHECK_RET</span><span class="p">(</span><span class="n">ret</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="n">LOG_PRINT</span><span class="p">(</span><span class="s">&#34;Init acl failed. ERROR: %d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">ret</span><span class="p">);</span> <span class="k">return</span> <span class="n">ret</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// 2.准备数据
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="c1">// 矩阵 1
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="n">mat1HostData</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">};</span>
</span></span><span class="line"><span class="cl">  <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int64_t</span><span class="o">&gt;</span> <span class="n">mat1Shape</span> <span class="o">=</span> <span class="p">{</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">};</span>
</span></span><span class="line"><span class="cl">  <span class="kt">void</span><span class="o">*</span> <span class="n">mat1DeviceAddr</span> <span class="o">=</span> <span class="k">nullptr</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">aclTensor</span><span class="o">*</span> <span class="n">mat1</span> <span class="o">=</span> <span class="k">nullptr</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">ret</span> <span class="o">=</span> <span class="n">CreateAclTensor</span><span class="p">(</span><span class="n">mat1HostData</span><span class="p">,</span> <span class="n">mat1Shape</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">mat1DeviceAddr</span><span class="p">,</span> <span class="n">aclDataType</span><span class="o">::</span><span class="n">ACL_FLOAT</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">mat1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">CHECK_RET</span><span class="p">(</span><span class="n">ret</span> <span class="o">==</span> <span class="n">ACL_SUCCESS</span><span class="p">,</span> <span class="n">LOG_PRINT</span><span class="p">(</span><span class="s">&#34;CreateAclTensor for mat1 failed. ERROR: %d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">ret</span><span class="p">);</span> <span class="k">return</span> <span class="n">ret</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// 矩阵 2
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="n">mat2HostData</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">};</span>
</span></span><span class="line"><span class="cl">  <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int64_t</span><span class="o">&gt;</span> <span class="n">mat2Shape</span> <span class="o">=</span> <span class="p">{</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">};</span>
</span></span><span class="line"><span class="cl">  <span class="kt">void</span><span class="o">*</span> <span class="n">mat2DeviceAddr</span> <span class="o">=</span> <span class="k">nullptr</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">aclTensor</span><span class="o">*</span> <span class="n">mat2</span> <span class="o">=</span> <span class="k">nullptr</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">ret</span> <span class="o">=</span> <span class="n">CreateAclTensor</span><span class="p">(</span><span class="n">mat2HostData</span><span class="p">,</span> <span class="n">mat2Shape</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">mat2DeviceAddr</span><span class="p">,</span> <span class="n">aclDataType</span><span class="o">::</span><span class="n">ACL_FLOAT</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">mat2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">CHECK_RET</span><span class="p">(</span><span class="n">ret</span> <span class="o">==</span> <span class="n">ACL_SUCCESS</span><span class="p">,</span> <span class="n">LOG_PRINT</span><span class="p">(</span><span class="s">&#34;CreateAclTensor for mat2 failed. ERROR: %d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">ret</span><span class="p">);</span> <span class="k">return</span> <span class="n">ret</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// 结果矩阵
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="n">outHostData</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">};</span>
</span></span><span class="line"><span class="cl">  <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int64_t</span><span class="o">&gt;</span> <span class="n">outShape</span> <span class="o">=</span> <span class="p">{</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">};</span>
</span></span><span class="line"><span class="cl">  <span class="kt">void</span><span class="o">*</span> <span class="n">outDeviceAddr</span> <span class="o">=</span> <span class="k">nullptr</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">aclTensor</span><span class="o">*</span> <span class="n">out</span> <span class="o">=</span> <span class="k">nullptr</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">ret</span> <span class="o">=</span> <span class="n">CreateAclTensor</span><span class="p">(</span><span class="n">outHostData</span><span class="p">,</span> <span class="n">outShape</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">outDeviceAddr</span><span class="p">,</span> <span class="n">aclDataType</span><span class="o">::</span><span class="n">ACL_FLOAT</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">out</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">CHECK_RET</span><span class="p">(</span><span class="n">ret</span> <span class="o">==</span> <span class="n">ACL_SUCCESS</span><span class="p">,</span> <span class="n">LOG_PRINT</span><span class="p">(</span><span class="s">&#34;CreateAclTensor for out failed. ERROR: %d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">ret</span><span class="p">);</span> <span class="k">return</span> <span class="n">ret</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// 3.调用 CANN 算子库 API
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">uint64_t</span> <span class="n">workspaceSize</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">aclOpExecutor</span><span class="o">*</span> <span class="n">executor</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="kt">int8_t</span> <span class="n">cubeMathType</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// 计算 device 内存
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">ret</span> <span class="o">=</span> <span class="n">aclnnMatmulGetWorkspaceSize</span><span class="p">(</span><span class="n">mat1</span><span class="p">,</span> <span class="n">mat2</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">cubeMathType</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">workspaceSize</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">executor</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">CHECK_RET</span><span class="p">(</span><span class="n">ret</span> <span class="o">==</span> <span class="n">ACL_SUCCESS</span><span class="p">,</span> <span class="n">LOG_PRINT</span><span class="p">(</span><span class="s">&#34;aclnnMatmulGetWorkspaceSize failed. ERROR: %d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">ret</span><span class="p">);</span> <span class="k">return</span> <span class="n">ret</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// 申请 device 内存
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">void</span><span class="o">*</span> <span class="n">workspaceAddr</span> <span class="o">=</span> <span class="k">nullptr</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="n">workspaceSize</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">ret</span> <span class="o">=</span> <span class="n">aclrtMalloc</span><span class="p">(</span><span class="o">&amp;</span><span class="n">workspaceAddr</span><span class="p">,</span> <span class="n">workspaceSize</span><span class="p">,</span> <span class="n">ACL_MEM_MALLOC_HUGE_FIRST</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">CHECK_RET</span><span class="p">(</span><span class="n">ret</span> <span class="o">==</span> <span class="n">ACL_SUCCESS</span><span class="p">,</span> <span class="n">LOG_PRINT</span><span class="p">(</span><span class="s">&#34;allocate workspace failed. ERROR: %d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">ret</span><span class="p">);</span> <span class="k">return</span> <span class="n">ret</span><span class="p">;);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// 执行计算过程
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">ret</span> <span class="o">=</span> <span class="n">aclnnMatmul</span><span class="p">(</span><span class="n">workspaceAddr</span><span class="p">,</span> <span class="n">workspaceSize</span><span class="p">,</span> <span class="n">executor</span><span class="p">,</span> <span class="n">stream</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">CHECK_RET</span><span class="p">(</span><span class="n">ret</span> <span class="o">==</span> <span class="n">ACL_SUCCESS</span><span class="p">,</span> <span class="n">LOG_PRINT</span><span class="p">(</span><span class="s">&#34;aclnnMatmul failed. ERROR: %d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">ret</span><span class="p">);</span> <span class="k">return</span> <span class="n">ret</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// 4.等待计算结果
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">ret</span> <span class="o">=</span> <span class="n">aclrtSynchronizeStream</span><span class="p">(</span><span class="n">stream</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">CHECK_RET</span><span class="p">(</span><span class="n">ret</span> <span class="o">==</span> <span class="n">ACL_SUCCESS</span><span class="p">,</span> <span class="n">LOG_PRINT</span><span class="p">(</span><span class="s">&#34;aclrtSynchronizeStream failed. ERROR: %d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">ret</span><span class="p">);</span> <span class="k">return</span> <span class="n">ret</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// 5.将 device 侧内存上的结果拷贝至 host 侧
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">auto</span> <span class="n">size</span> <span class="o">=</span> <span class="n">GetShapeSize</span><span class="p">(</span><span class="n">outShape</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="n">resultData</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">ret</span> <span class="o">=</span> <span class="n">aclrtMemcpy</span><span class="p">(</span><span class="n">resultData</span><span class="p">.</span><span class="n">data</span><span class="p">(),</span> <span class="n">resultData</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">resultData</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">outDeviceAddr</span><span class="p">,</span> <span class="n">size</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">float</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                    <span class="n">ACL_MEMCPY_DEVICE_TO_HOST</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">CHECK_RET</span><span class="p">(</span><span class="n">ret</span> <span class="o">==</span> <span class="n">ACL_SUCCESS</span><span class="p">,</span> <span class="n">LOG_PRINT</span><span class="p">(</span><span class="s">&#34;copy result from device to host failed. ERROR: %d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">ret</span><span class="p">);</span> <span class="k">return</span> <span class="n">ret</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="kt">int64_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">size</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">LOG_PRINT</span><span class="p">(</span><span class="s">&#34;result[%ld] is: %f</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">resultData</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// 6.释放 aclTensor
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">aclDestroyTensor</span><span class="p">(</span><span class="n">mat1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">aclDestroyTensor</span><span class="p">(</span><span class="n">mat1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">aclDestroyTensor</span><span class="p">(</span><span class="n">out</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// 7.释放 device 资源
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">aclrtFree</span><span class="p">(</span><span class="n">mat1DeviceAddr</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">aclrtFree</span><span class="p">(</span><span class="n">mat2DeviceAddr</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">aclrtFree</span><span class="p">(</span><span class="n">outDeviceAddr</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="n">workspaceSize</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">aclrtFree</span><span class="p">(</span><span class="n">workspaceAddr</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="n">aclrtDestroyStream</span><span class="p">(</span><span class="n">stream</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">aclrtResetDevice</span><span class="p">(</span><span class="n">deviceId</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">aclFinalize</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>运行程序：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">./opapi_mul_test
</span></span></code></pre></div><p>运行结果：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">sss@xxx:~/xxx/mul/build/bin$ ./opapi_test 
</span></span><span class="line"><span class="cl">result<span class="o">[</span>0<span class="o">]</span> is: 9.000000
</span></span><span class="line"><span class="cl">result<span class="o">[</span>1<span class="o">]</span> is: 12.000000
</span></span><span class="line"><span class="cl">result<span class="o">[</span>2<span class="o">]</span> is: 15.000000
</span></span><span class="line"><span class="cl">result<span class="o">[</span>3<span class="o">]</span> is: 19.000000
</span></span><span class="line"><span class="cl">result<span class="o">[</span>4<span class="o">]</span> is: 26.000000
</span></span><span class="line"><span class="cl">result<span class="o">[</span>5<span class="o">]</span> is: 33.000000
</span></span><span class="line"><span class="cl">result<span class="o">[</span>6<span class="o">]</span> is: 29.000000
</span></span><span class="line"><span class="cl">result<span class="o">[</span>7<span class="o">]</span> is: 40.000000
</span></span><span class="line"><span class="cl">result<span class="o">[</span>8<span class="o">]</span> is: 51.000000
</span></span></code></pre></div><blockquote>
<p>参考资料：</p>
<ul>
<li><a href="https://github.com/wangshuai09/Notebook/blob/main/Ascend%E7%AE%97%E5%AD%90%E5%BC%80%E5%8F%91%E6%8C%87%E5%8D%97/aclnn%E7%AE%97%E5%AD%90%E5%BC%80%E5%8F%91%E6%8C%87%E5%8D%97.md" target="_blank"><u>Ascend 算子开发指南</u></a></li>
<li><a href="https://www.hiascend.com/document/detail/zh/CANNCommunityEdition/80RC3alpha003/quickstart/quickstart/quickstart_18_0001.html" target="_blank"><u>CANN 社区版开发文档</u></a></li>
<li><a href="https://www.hiascend.com/document/detail/zh/CANNCommunityEdition/80RC3alpha003/devguide/appdevg/aclcppdevg/aclcppdevg_000019.html" target="_blank"><u>调用 NN 算子接口示例代码</u></a></li>
<li><a href="https://www.hiascend.com/document/detail/zh/CANNCommunityEdition/80RC3alpha003/apiref/aolapi/operatorlist_0001.html" target="_blank"><u>算子加速库接口</u></a></li>
</ul>
</blockquote>

          
          
          
        </div>
        
        

          
            
            
<div class="flex author">
  
    
    
      
    
    
      
        
      
      <img class="!mt-0 !mb-0 h-24 w-24 rounded-full ltr:mr-4 rtl:ml-4" width="96" height="96"
      alt="Shanshan Shen" src="/images/logo_hu9373694138991197219.jpg" />
    
  
  <div class="place-self-center">
    
    <div class="text-[0.6rem] uppercase leading-3 text-neutral-500 dark:text-neutral-400">
      Author
    </div>
    <div class="font-semibold leading-6 text-neutral-800 dark:text-neutral-300">
      Shanshan Shen
    </div>
    
    
    <div class="text-sm text-neutral-700 dark:text-neutral-400">A programmer ingaging in AI Infra.</div>
    
    <div class="text-2xl sm:text-lg">
  <div class="flex flex-wrap text-neutral-400 dark:text-neutral-500">
    
      
        <a
          class="px-1 hover:text-primary-700 dark:hover:text-primary-400"
          href="https://github.com/shen-shanshan"
          target="_blank"
          aria-label="Github"
          rel="me noopener noreferrer"
          ><span class="inline-block align-text-bottom">

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>

  </span>

</span></a
        >
      
    
      
        <a
          class="px-1 hover:text-primary-700 dark:hover:text-primary-400"
          href="https://gitee.com/shenshanshan0918"
          target="_blank"
          aria-label="Gitee"
          rel="me noopener noreferrer"
          ><span class="inline-block align-text-bottom">

  <span class="relative block icon">
    <svg fill="currentColor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--!Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--><path d="M224 96C135.6 96 64 167.6 64 256s71.6 160 160 160c77.4 0 142-55 156.8-128L256 288c-17.7 0-32-14.3-32-32s14.3-32 32-32l144 0c25.8 0 49.6 21.4 47.2 50.6C437.8 389.6 341.4 480 224 480C100.3 480 0 379.7 0 256S100.3 32 224 32c57.4 0 109.7 21.6 149.3 57c13.2 11.8 14.3 32 2.5 45.2s-32 14.3-45.2 2.5C302.3 111.4 265 96 224 96z"/></svg>
  </span>

</span></a
        >
      
    
      
        <a
          class="px-1 hover:text-primary-700 dark:hover:text-primary-400"
          href="https://blog.csdn.net/weixin_44162047?type=blog"
          target="_blank"
          aria-label="Csdn"
          rel="me noopener noreferrer"
          ><span class="inline-block align-text-bottom">

  <span class="relative block icon">
    <svg fill="currentColor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--!Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--><path d="M329.1 142.9c-62.5-62.5-155.8-62.5-218.3 0s-62.5 163.8 0 226.3s155.8 62.5 218.3 0c12.5-12.5 32.8-12.5 45.3 0s12.5 32.8 0 45.3c-87.5 87.5-221.3 87.5-308.8 0s-87.5-229.3 0-316.8s221.3-87.5 308.8 0c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0z"/></svg>
  </span>

</span></a
        >
      
    
      
        <a
          class="px-1 hover:text-primary-700 dark:hover:text-primary-400"
          href="https://www.zhihu.com/people/sss-53-26"
          target="_blank"
          aria-label="Zhihu"
          rel="me noopener noreferrer"
          ><span class="inline-block align-text-bottom">

  <span class="relative block icon">
    <svg fill="currentColor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--!Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--><path d="M170.5 148.1v217.5l23.4 0 7.7 26.4 42-26.4h49.5V148.1H170.5zm97.8 193.9h-27.9l-27.9 17.5-5.1-17.5-11.9 0V171.8h72.8v170.3zm-118.5-94.4H97.5c1.7-27.1 2.2-51.6 2.2-73.5h51.2s2-22.6-8.6-22.3h-88.5c3.5-13.1 7.9-26.7 13.1-40.7 0 0-24.1 0-32.3 21.6-3.4 8.9-13.2 43.1-30.7 78.1 5.9-.6 25.4-1.2 36.8-22.2 2.1-5.9 2.5-6.7 5.1-14.5h28.9c0 10.5-1.2 66.9-1.7 73.4H20.8c-11.7 0-15.6 23.6-15.6 23.6h65.6C66.5 321.1 42.8 363.1 0 396.3c20.5 5.9 40.9-.9 51-9.9 0 0 23-20.9 35.6-69.3l54 64.9s7.9-26.9-1.2-40c-7.6-8.9-28.1-33.1-36.8-41.8L87.9 312c4.4-14 7-27.6 7.9-40.7h61.7s-.1-23.6-7.6-23.6v0zm412-1.6c20.8-25.6 45-58.6 45-58.6s-18.7-14.8-27.4-4.1c-6 8.2-36.8 48.2-36.8 48.2l19.2 14.4zm-150.1-59.1c-9-8.3-25.9 2.1-25.9 2.1s39.5 55 41.1 57.5l19.5-13.7s-25.7-37.6-34.7-45.9h0zM640 258.4c-19.8 0-130.9 .9-131.1 .9v-101c4.8 0 12.4-.4 22.9-1.2 40.9-2.4 70.1-4 87.8-4.8 0 0 12.2-27.2-.6-33.4-3.1-1.2-23.2 4.6-23.2 4.6s-165.2 16.5-232.4 18.1c1.6 8.8 7.6 17.1 15.8 19.6 13.3 3.5 22.7 1.7 49.2 .9 24.8-1.6 43.7-2.4 56.5-2.4v99.8H351.4s2.8 22.3 25.5 22.9h107.9v70.9c0 14-11.2 22-24.5 21.1-14.1 .1-26.1-1.2-41.7-1.8 2 4 6.3 14.4 19.3 21.8 9.9 4.8 16.2 6.6 26 6.6 29.6 0 45.7-17.3 44.9-45.3v-73.3h122.4c9.7 0 8.7-23.8 8.7-23.8l0 0z"/></svg>
  </span>

</span></a
        >
      
    
      
        <a
          class="px-1 hover:text-primary-700 dark:hover:text-primary-400"
          href="https://space.bilibili.com/14112152?spm_id_from=333.1007.0.0"
          target="_blank"
          aria-label="Bilibili"
          rel="me noopener noreferrer"
          ><span class="inline-block align-text-bottom">

  <span class="relative block icon">
    <svg fill="currentColor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--!Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--><path d="M488.6 104.1C505.3 122.2 513 143.8 511.9 169.8V372.2C511.5 398.6 502.7 420.3 485.4 437.3C468.2 454.3 446.3 463.2 419.9 464H92C65.6 463.2 43.8 454.2 26.7 436.8C9.7 419.4 .8 396.5 0 368.2V169.8C.8 143.8 9.7 122.2 26.7 104.1C43.8 87.8 65.6 78.8 92 78H121.4L96.1 52.2C90.3 46.5 87.4 39.2 87.4 30.4C87.4 21.6 90.3 14.3 96.1 8.6C101.8 2.9 109.1 0 117.9 0C126.7 0 134 2.9 139.8 8.6L213.1 78H301.1L375.6 8.6C381.7 2.9 389.2 0 398 0C406.8 0 414.1 2.9 419.9 8.6C425.6 14.3 428.5 21.6 428.5 30.4C428.5 39.2 425.6 46.5 419.9 52.2L394.6 78L423.9 78C450.3 78.8 471.9 87.8 488.6 104.1H488.6zM449.8 173.8C449.4 164.2 446.1 156.4 439.1 150.3C433.9 144.2 425.1 140.9 416.4 140.5H96.1C86.5 140.9 78.6 144.2 72.5 150.3C66.3 156.4 63.1 164.2 62.7 173.8V368.2C62.7 377.4 66 385.2 72.5 391.7C79 398.2 86.9 401.5 96.1 401.5H416.4C425.6 401.5 433.4 398.2 439.7 391.7C446 385.2 449.4 377.4 449.8 368.2L449.8 173.8zM185.5 216.5C191.8 222.8 195.2 230.6 195.6 239.7V273C195.2 282.2 191.9 289.9 185.8 296.2C179.6 302.5 171.8 305.7 162.2 305.7C152.6 305.7 144.7 302.5 138.6 296.2C132.5 289.9 129.2 282.2 128.8 273V239.7C129.2 230.6 132.6 222.8 138.9 216.5C145.2 210.2 152.1 206.9 162.2 206.5C171.4 206.9 179.2 210.2 185.5 216.5H185.5zM377 216.5C383.3 222.8 386.7 230.6 387.1 239.7V273C386.7 282.2 383.4 289.9 377.3 296.2C371.2 302.5 363.3 305.7 353.7 305.7C344.1 305.7 336.3 302.5 330.1 296.2C323.1 289.9 320.7 282.2 320.4 273V239.7C320.7 230.6 324.1 222.8 330.4 216.5C336.7 210.2 344.5 206.9 353.7 206.5C362.9 206.9 370.7 210.2 377 216.5H377z"/></svg>
  </span>

</span></a
        >
      
    
      
        <a
          class="px-1 hover:text-primary-700 dark:hover:text-primary-400"
          href="https://music.163.com/#/artist?id=62054947"
          target="_blank"
          aria-label="Music"
          rel="me noopener noreferrer"
          ><span class="inline-block align-text-bottom">

  <span class="relative block icon">
    <svg fill="currentColor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--!Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--><path d="M499.1 6.3c8.1 6 12.9 15.6 12.9 25.7l0 72 0 264c0 44.2-43 80-96 80s-96-35.8-96-80s43-80 96-80c11.2 0 22 1.6 32 4.6L448 147 192 223.8 192 432c0 44.2-43 80-96 80s-96-35.8-96-80s43-80 96-80c11.2 0 22 1.6 32 4.6L128 200l0-72c0-14.1 9.3-26.6 22.8-30.7l320-96c9.7-2.9 20.2-1.1 28.3 5z"/></svg>
  </span>

</span></a
        >
      
    
  </div>

</div>
  </div>
</div>

          

          

          
          <div class="mb-10"></div>
          

        

        
        

        


<h2 class="mt-8 text-2xl font-extrabold mb-10">Related</h2>
<section class="w-full grid gap-4 sm:grid-cols-2 md:grid-cols-3">
  
  

  <a href="/articles/%E5%9F%BA%E4%BA%8E-euleros-ascend-npu-%E6%90%AD%E5%BB%BA-pytorch-%E8%BF%9C%E7%A8%8B%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/" class="min-w-full">
    
    <div class="min-h-full border border-neutral-200 dark:border-neutral-700 border-2 rounded overflow-hidden shadow-2xl relative">
        
        <div class="w-full thumbnail_card_related nozoom" style="background-image:url(/articles/%E5%9F%BA%E4%BA%8E-euleros-ascend-npu-%E6%90%AD%E5%BB%BA-pytorch-%E8%BF%9C%E7%A8%8B%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/featured_hu9253359173625983682.jpg);"></div>
        
      

      <div class="px-6 py-4">

        
        <div class="font-bold text-xl text-neutral-800 decoration-primary-500 hover:underline hover:underline-offset-2 dark:text-neutral"
          href="/articles/%E5%9F%BA%E4%BA%8E-euleros-ascend-npu-%E6%90%AD%E5%BB%BA-pytorch-%E8%BF%9C%E7%A8%8B%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/">基于 EulerOS & Ascend NPU 搭建 PyTorch 远程开发环境</div>
        

        <div class="text-sm text-neutral-500 dark:text-neutral-400">
          











  



















<div class="flex flex-row flex-wrap items-center">
  
  
  <time datetime="2024-09-24T15:47:40&#43;00:00">2024-09-24</time>
  

  
  
</div>





<div class="flex flex-row flex-wrap items-center">
  
  
  
  
  
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA/&#34;,'_self');">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    计算机
  </span>
</span>
  </span>
  
  
  
  
  
  
  
  
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/tags/ai-infra/&#34;,'_self');">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    AI Infra
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/tags/ascend/&#34;,'_self');">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Ascend
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/tags/npu/&#34;,'_self');">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    NPU
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/tags/cann/&#34;,'_self');">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    CANN
  </span>
</span>
  </span>
  
  
  
  
</div>




        </div>

        
        <div class="py-1 prose dark:prose-invert">
          
        </div>
        
      </div>
      <div class="px-6 pt-4 pb-2">

      </div>
    </div>
  </a>

  
  

  <a href="/articles/ascend-npu-%E6%9E%B6%E6%9E%84-cann-%E5%B9%B3%E5%8F%B0%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/" class="min-w-full">
    
    <div class="min-h-full border border-neutral-200 dark:border-neutral-700 border-2 rounded overflow-hidden shadow-2xl relative">
        
        <div class="w-full thumbnail_card_related nozoom" style="background-image:url(/articles/ascend-npu-%E6%9E%B6%E6%9E%84-cann-%E5%B9%B3%E5%8F%B0%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/featured_hu9253359173625983682.jpg);"></div>
        
      

      <div class="px-6 py-4">

        
        <div class="font-bold text-xl text-neutral-800 decoration-primary-500 hover:underline hover:underline-offset-2 dark:text-neutral"
          href="/articles/ascend-npu-%E6%9E%B6%E6%9E%84-cann-%E5%B9%B3%E5%8F%B0%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/">Ascend NPU 架构 & CANN 平台入门学习</div>
        

        <div class="text-sm text-neutral-500 dark:text-neutral-400">
          











  



















<div class="flex flex-row flex-wrap items-center">
  
  
  <time datetime="2024-08-31T15:35:00&#43;00:00">2024-08-31</time>
  

  
  
</div>





<div class="flex flex-row flex-wrap items-center">
  
  
  
  
  
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA/&#34;,'_self');">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    计算机
  </span>
</span>
  </span>
  
  
  
  
  
  
  
  
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/tags/ai-infra/&#34;,'_self');">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    AI Infra
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/tags/ascend/&#34;,'_self');">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Ascend
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/tags/npu/&#34;,'_self');">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    NPU
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/tags/cann/&#34;,'_self');">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    CANN
  </span>
</span>
  </span>
  
  
  
  
</div>




        </div>

        
        <div class="py-1 prose dark:prose-invert">
          
        </div>
        
      </div>
      <div class="px-6 pt-4 pb-2">

      </div>
    </div>
  </a>

  
  

  <a href="/articles/nvidia-gpu-%E6%9E%B6%E6%9E%84-cuda-%E5%B9%B3%E5%8F%B0%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/" class="min-w-full">
    
    <div class="min-h-full border border-neutral-200 dark:border-neutral-700 border-2 rounded overflow-hidden shadow-2xl relative">
        
        <div class="w-full thumbnail_card_related nozoom" style="background-image:url(/articles/nvidia-gpu-%E6%9E%B6%E6%9E%84-cuda-%E5%B9%B3%E5%8F%B0%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/featured_hu9253359173625983682.jpg);"></div>
        
      

      <div class="px-6 py-4">

        
        <div class="font-bold text-xl text-neutral-800 decoration-primary-500 hover:underline hover:underline-offset-2 dark:text-neutral"
          href="/articles/nvidia-gpu-%E6%9E%B6%E6%9E%84-cuda-%E5%B9%B3%E5%8F%B0%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/">NVIDIA GPU 架构 & CUDA 平台入门学习</div>
        

        <div class="text-sm text-neutral-500 dark:text-neutral-400">
          











  



















<div class="flex flex-row flex-wrap items-center">
  
  
  <time datetime="2024-08-26T15:12:08&#43;00:00">2024-08-26</time>
  

  
  
</div>





<div class="flex flex-row flex-wrap items-center">
  
  
  
  
  
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA/&#34;,'_self');">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    计算机
  </span>
</span>
  </span>
  
  
  
  
  
  
  
  
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/tags/ai-infra/&#34;,'_self');">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    AI Infra
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/tags/nvidia/&#34;,'_self');">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    NVIDIA
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/tags/gpu/&#34;,'_self');">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    GPU
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/tags/cuda/&#34;,'_self');">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    CUDA
  </span>
</span>
  </span>
  
  
  
  
</div>




        </div>

        
        <div class="py-1 prose dark:prose-invert">
          
        </div>
        
      </div>
      <div class="px-6 pt-4 pb-2">

      </div>
    </div>
  </a>

  
</section>

  
      </div>
     
      
      
        
        
          
          
        
      <script>
        var oid = "views_posts\/【计算机】Ascend-aclnn算子开发入门\/index.md"
        var oid_likes = "likes_posts\/【计算机】Ascend-aclnn算子开发入门\/index.md"
      </script>
      
      
      <script type="text/javascript" src="/js/page.min.0860cf4e04fa2d72cc33ddba263083464d48f67de06114529043cb4623319efed4f484fd7f1730df5abea0e2da6f3538855634081d02f2d6e920b956f063e823.js" integrity="sha512-CGDPTgT6LXLMM926JjCDRk1I9n3gYRRSkEPLRiMxnv7U9IT9fxcw31q&#43;oOLabzU4hVY0CB0C8tbpILlW8GPoIw=="></script>
      
  
    </section>
  <footer class="pt-8 max-w-prose print:hidden">

    

    
  </footer>
</article>

      <div id="top-scroller" class="pointer-events-none absolute top-[110vh] bottom-0 w-12 ltr:right-0 rtl:left-0">
  <a href="#the-top"
    class="pointer-events-auto sticky top-[calc(100vh-5.5rem)] flex h-12 w-12 mb-16 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400"
    aria-label="Scroll to top" title="Scroll to top">
    &uarr;
  </a>
</div>
    </main><footer id="site-footer" class="py-10 print:hidden">
  
  
    
  
  <div class="flex items-center justify-between">

    
    
    <p class="text-sm text-neutral-500 dark:text-neutral-400">
      &copy;
      2025
      Shanshan Shen
    </p>
    

    
    
    <p class="text-xs text-neutral-500 dark:text-neutral-400">
      
      
      Powered by <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500"
        href="https://gohugo.io/" target="_blank" rel="noopener noreferrer">Hugo</a> &amp; <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500"
        href="https://blowfish.page/" target="_blank" rel="noopener noreferrer">Blowfish</a>
    </p>
    

  </div>
  <script>
    
    mediumZoom(document.querySelectorAll("img:not(.nozoom)"), {
      margin: 24,
      background: 'rgba(0,0,0,0.5)',
      scrollOffset: 0,
    })
    
  </script>
  
  
  <script type="text/javascript" src="/js/process.min.ee03488f19c93c2efb199e2e3014ea5f3cb2ce7d45154adb3399a158cac27ca52831db249ede5bb602700ef87eb02434139de0858af1818ab0fb4182472204a4.js" integrity="sha512-7gNIjxnJPC77GZ4uMBTqXzyyzn1FFUrbM5mhWMrCfKUoMdsknt5btgJwDvh&#43;sCQ0E53ghYrxgYqw&#43;0GCRyIEpA=="></script>
  
  
</footer>
<div
  id="search-wrapper"
  class="invisible fixed inset-0 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm dark:bg-neutral-900/50 sm:p-6 md:p-[10vh] lg:p-[12vh]"
  data-url="http://localhost:1313/"
  style="z-index:500"
>
  <div
    id="search-modal"
    class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg top-20 border-neutral-200 bg-neutral dark:border-neutral-700 dark:bg-neutral-800"
  >
    <header class="relative z-10 flex items-center justify-between flex-none px-2">
      <form class="flex items-center flex-auto min-w-0">
        <div class="flex items-center justify-center w-8 h-8 text-neutral-400">
          

  <span class="relative block icon">
    <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>

  </span>


        </div>
        <input
          type="search"
          id="search-query"
          class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent"
          placeholder="Search"
          tabindex="0"
        />
      </form>
      <button
        id="close-search-button"
        class="flex items-center justify-center w-8 h-8 text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400"
        title="Close (Esc)"
      >
        

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"/></svg>

  </span>


      </button>
    </header>
    <section class="flex-auto px-2 overflow-auto">
      <ul id="search-results">
        
      </ul>
    </section>
  </div>
</div>

  </div>
</body>

</html>
